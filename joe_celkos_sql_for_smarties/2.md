# プログラマのためのSQL_2章
#プログラマのためのSQL

## 2.2 トランザクションとACID特性
**ACID特性**

### 2.2.1 Atomicity
`トランザクションすべてが永続化される`か`トランザクションすべてが永続化されない`の2状態しか存在しない
100万行を挿入している際に1行だけ整合性に違反していてもすべての挿入が破棄される
逆に1行ずつ100万行の挿入を行うと途中でユーザーのアクセスによって意図しない挙動が発生する
以上はトレードオフである。

`SQL:2006`では`SAVEPOINT`が導入され、限定的なロールバックが可能になった。

`SAVEPOINT`の代替手段は
* トランザクションを細かく分割する
* ~~ETL(Extract Transform Load)ツール~~を用いる
	* データベースにロードする前に完璧にデータの整合性をチェックしてくれる
のいずれかである。

### 2.2.2 Consistency
トランザクションの開始時、および永続化された時点でもデータベースは**一貫した状態**にある。
**一貫した状態**とはすべての~~データ整合性制約~~、~~参照整合性制約~~などすべての制約が満たされている状態のことを指す。

### 2.2.3 Isolation
**ひとつのトランザクションは他のいかなるトランザクションからも独立している。**
トランザクションを直列に実行したときと同じ結果になるという意味

世の中のDBMSは**いかにしてトランザクション同士の干渉を防ぎ、直列と同じ結果を得ることができるか**を考えている

### 2.2.4 Durability
**ロギングとバックアップの機能**
DBプログラムが壊れてから復旧した際もデータベースを一貫した状態に復元することができる

## 2.3 同時実行制御
同時実行制御とは**複数のユーザーがデータベースを共有して使う環境で以下にして互いに干渉せずにトランザクションを行うか**を考える分野

### 2.3.1 5つの現象
ユーザーが発行するSQLが検索のみの場合は問題は起こらない。
2人以上のユーザーが同時に更新を行う場合に問題が起こる。

SQLモデルでは1つのトランザクションが他のトランザクションに影響を与えるのは5パターン存在する。

#### P0(ダーティライト)

#### P1(ダーティリード)

#### P2(反復不能読み取り)

#### P3(ファントム)

#### P4(失われた更新)
